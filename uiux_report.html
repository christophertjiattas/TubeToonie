<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TubeToonie Streamlit UI/UX Review & Changes</title>
  <style>
    :root {
      --bg: #0e1117;
      --panel: #161b22;
      --text: #e6edf3;
      --muted: #9aa4af;
      --accent: #7c5cfc;
      --ok: #2ea043;
      --warn: #d29922;
      --bad: #f85149;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
    }
    body { margin: 0; background: var(--bg); color: var(--text); font-family: var(--sans); line-height: 1.55; }
    header { padding: 28px 18px; border-bottom: 1px solid #243041; background: linear-gradient(180deg, #0e1117, #0e1117); }
    header h1 { margin: 0 0 6px; font-size: 22px; }
    header p { margin: 0; color: var(--muted); }
    main { max-width: 1000px; margin: 0 auto; padding: 18px; }
    section { background: var(--panel); border: 1px solid #243041; border-radius: 12px; padding: 16px; margin: 14px 0; }
    h2 { margin: 0 0 10px; font-size: 18px; }
    h3 { margin: 14px 0 8px; font-size: 15px; color: var(--text); }
    ul { margin: 8px 0 0 18px; }
    code, pre { font-family: var(--mono); }
    pre { background: #0b0f14; border: 1px solid #243041; border-radius: 10px; padding: 12px; overflow: auto; }
    .pill { display: inline-block; padding: 2px 8px; border-radius: 999px; border: 1px solid #2a3a52; color: var(--muted); font-size: 12px; }
    .ok { color: var(--ok); }
    .warn { color: var(--warn); }
    .bad { color: var(--bad); }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    @media (max-width: 850px) { .grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
<header>
  <h1>TubeToonie Streamlit UI/UX Review & Changes</h1>
  <p>Project: <span class="pill">002 youtube-audio</span> &middot; Generated by scooby (code-puppy-9fd57c)</p>
</header>

<main>
  <section>
    <h2>Goals</h2>
    <ul>
      <li>Make the app <b>easy to understand</b> without reading the README first.</li>
      <li>Make it <b>obvious what to do next</b> (step-by-step flow).</li>
      <li>Support <b>two sources</b>: YouTube downloads and local audio uploads.</li>
      <li>Support <b>multi-Tonie targeting</b>: upload to one, the other, or both.</li>
      <li>Provide <b>strong validation</b>: user can verify that a download worked (audio preview + downloadable file).</li>
      <li>Keep Tonie integration <b>optional</b> (feature flags via credentials + optional dependency).</li>
      <li>Add Tonie content management: <b>list tonies</b>, <b>see songs</b>, and (if supported) <b>rename + reorder chapters</b>.</li>
    </ul>
  </section>

  <section>
    <h2>Major UI changes</h2>
    <div class="grid">
      <div>
        <h3>1) Clear information architecture</h3>
        <ul>
          <li>Replaced a single long page with <b>tabs</b>: <code>Download</code> / <code>Tonie Library</code> / <code>Settings</code>.</li>
          <li>Moved credential entry + target tonie selection into <b>Settings</b> (less clutter during downloads).</li>
        </ul>
      </div>
      <div>
        <h3>2) Validation + transparency</h3>
        <ul>
          <li>Added a <b>Results</b> section after processing with <b>audio playback</b> and <b>download button</b> (works for both YouTube downloads and local uploads).</li>
          <li>Added an <b>Activity log</b> expander that records key steps and errors.</li>
        </ul>
      </div>
    </div>

    <h3>3) Better defaults</h3>
    <ul>
      <li>Layout set to <code>wide</code> for better readability.</li>
      <li>Output directory default stays <code>./downloads</code>, with copy explaining the intent.</li>
    </ul>
  </section>

  <section>
    <h2>Tonie integration UX changes</h2>
    <p class="pill">Update</p>
    <p>Auto-upload now supports targeting multiple Creative Tonies (one/other/both) via Streamlit multi-select.</p>
    <h3>Credentials discovery (least surprise)</h3>
    <ul>
      <li>Credentials are resolved from (in order): UI input &rarr; env vars &rarr; local config file.</li>
      <li>Credentials can be stored securely in the OS credential store via <code>keyring</code> (macOS Keychain / Windows Credential Manager).</li>
      <li>
        <span class="warn">Important limitation:</span> Streamlit cannot mutate your parent shell environment.
        Instead, the UI shows copy/paste <code>export</code> commands.
      </li>
    </ul>

    <h3>Dropdown target selection</h3>
    <ul>
      <li>After refreshing tonies, Settings shows an <b>Upload target</b> dropdown.</li>
      <li>Dropdown selection overrides <code>TONIE_CREATIVE_TONIE_ID</code> env var (when present).</li>
    </ul>
  </section>

  <section>
    <h2>Rename + reorder songs on a Creative Tonie</h2>
    <p>
      Implemented a Tonie Library editor that allows:
      <b>reordering</b> via position numbers and <b>renaming</b> via editable title fields.
    </p>
    <ul>
      <li>
        Data source: <code>list_creative_tonies_detailed()</code> (includes chapter <code>id</code> and <code>file</code> token required by the API).
      </li>
      <li>
        Apply action: <code>update_creative_tonie_chapters()</code> which uses tonie-apis
        <code>sort_chapter_of_tonie()</code> (PATCH to Tonie Cloud with a full chapters list).
      </li>
      <li>
        <span class="pill">Behavior</span> Positions must be unique; ordering is applied by sorting <code>Pos</code> ascending.
      </li>
    </ul>
    <p class="warn">
      Note: This relies on Tonie Cloud accepting updated chapter titles via the same PATCH used for sorting.
      In practice this is commonly supported, but if Tonie Cloud rejects title changes, we can fall back to a dedicated rename endpoint (if we discover one).
    </p>
  </section>

  <section>
    <h2>Visual design: theme & polish</h2>
    <ul>
      <li>Added a Streamlit theme file: <code>.streamlit/config.toml</code></li>
      <li>Dark base with a consistent accent color (<span class="pill">#7C5CFC</span>) for buttons and highlights.</li>
    </ul>
  </section>

  <section>
    <h2>Testing performed</h2>
    <ul>
      <li><span class="ok">Syntax check:</span> <code>python -m py_compile</code> on project Python files.</li>
      <li><span class="ok">Unit tests:</span> Added <code>tests/test_basic.py</code> (URL normalization, config save/load, credential priority).</li>
      <li><span class="ok">Result:</span> <code>5 passed</code> via <code>pytest -q</code>.</li>
    </ul>
    <pre><code>5 passed in 0.02s</code></pre>
  </section>

  <section>
    <h2>Files changed / added</h2>
    <ul>
      <li><code>YTAudioUI.py</code>  rewritten for tabs + results + activity log + Tonie library editor.</li>
      <li><code>ytaudio_tonie.py</code>  added detailed tonie listing + chapter update function.</li>
      <li><code>ytaudio_secrets.py</code>  secure credential storage via macOS Keychain / Windows Credential Manager.</li>
      <li><code>.streamlit/config.toml</code>  theme config.</li>
      <li><code>requirements-dev.txt</code> and <code>tests/test_basic.py</code>  basic test coverage.</li>
      <li><code>run-ui-easy.sh</code>  one-command setup + launch for Streamlit.</li>
    </ul>
  </section>

  <section>
    <h2>Future UX features (recommended)</h2>
    <ul>
      <li><b>Queue view</b>: show a per-URL queue with success/failure badges and per-item logs.</li>
      <li><b>Batch Tonie upload</b>: upload multiple MP3s as chapters in a selected order (playlist builder).</li>
      <li><b>Clear tonie / replace playlist</b>: one-click  clear chapters then upload new set.</li>
      <li><b>Better chapter editor</b>: drag-and-drop ordering (Streamlit component) instead of numeric positions.</li>
      <li><b>Credential storage in keychain</b> on macOS instead of plaintext config (more secure, more complex).</li>
      <li><b>Retry UX</b>: one-click  retry failed downloads with cookie hints (403 handling).</li>
    </ul>
  </section>

  <section>
    <h2>Notes / constraints</h2>
    <ul>
      <li>
        Tonie support remains optional and only activates when:
        <ul>
          <li><code>tonie-api</code> is installed (<code>requirements-tonie.txt</code>)</li>
          <li>credentials are provided (UI/env/config)</li>
        </ul>
      </li>
      <li>ffmpeg is still a system dependency (Homebrew/apt), not a Python dependency.</li>
    </ul>
  </section>
</main>
</body>
</html>
